# 요구사항
- 기능 목록
    - 회원 기능
        - 회원 등록
        - 회원 조회
    - 상품 기능
        - 상품 등록
        - 상품 수정
        - 상품 조회
    - 주문 기능 
        - 상품 주문
        - 주문 내역 조회
        - 주문 취소
    - 기타 요구사항
        - 상품은 재고 관리가 필요하다.
        - 상품의 종류는 도서, 음반, 영화가 있다. 상품을 카테고리로 구분할 수 있다.
        - 상품 주문시 배송 정보를 입력할 수 있다.

# 도메인 모델과 테이블 설계
1. 회원 1 : N 주문
2. 주문 1 : 1 배송
3. 주문 1 : 다 주문상품 다 : 1 상품
4. 상품 다 : 다 카테고리
5. 상품 (앨범, 책, 영화)

## 엔티티 클래스 개발
- Getter의 경우는 모두 열어두는 것이 편리하다.
- Setter는 열어둘경우 변경에 대해 유지보수가 힘들기 때문에 setter를 사용하지 않고, 메서드를 별도로 제공하는게 좋다.
- 실무에서는 @ManyToMany 쓰지말자 중간테이블 관리가 힘들다 (값을 추가할 수 없다.)
- @Embedded -> 값타입은 생성자를 사용하고 수정자를 쓰지말자( 변경이 불가능해야 한다. )
    - 기본 생성자를 사용해야한다 (jpa 스팩) -> 기본 생성자의 접근 권한을 protected로 해주는 게 좋다.
- jpa가 만들어준 sql ddl을 그대로 사용하지말고 수정해서 사용하자

## 엔티티 설계 주의점
1. 엔티티에는 Setter를 사용하지 말자.
    - 변경 포인트가 많아 유지보수가 어렵다
2. 모든 연관관계는 지연로딩을 설정한다.
    - 즉시로딩(EAGER)은 예측이 어렵고, 어떤 sql이 실행될지 추적하기 어렵다. 특히 jpql을 사용할떄 N+1의 문제가 생긴다.
    - 실무에서 모든 연관관계는 (LAZY)로 설정해야 한다.
    - 함꼐 조회할때는 fetch join 또는 엔티티 그래프 기능을 사용한다.
    - @XToOne은 기본이 EAGER이기 때문에 필히 변경해줘야 한다.
3. 컬렉션 필드는 필드 정의때 초기화해주자
    - `null`에서 안전하다
    - 하이버네이트가 컬렉션을 내장 컬렉션으로 감싸서 변경하기 때문에 내부 메커니즘에 문제가 생긴다
    - 컬렉션을 대체 하지마라
4. 테이블, 컬럼명 생선 기본 전략
    - spring boot
        - camel case를 언더스코어로 바꿈
        - .을 _로
        - SpringPhysicalNamingStrategy
5. cascade
    - type.all -> 생명주기를 같이한다.
    - 참조하는게 다른 곳에서 쓰지 않을때 써야함.

## test에서 spring data source를 적어주지 않는다면 테스트를 돌릴 때 기본적으로 memory mode로 올려준다.


## 변경 감지와 병합 -> 실무에서 항상 변경 감지를 사용하자.
- 기본적으로 jpa는 영속성 컨텍스트에서 관리하는 것들의 변경을 dirty checking을 통해 커밋 시점에 업데이트 쿼리를 날려준다.
- 병합 merge -> itemId를 통해 찾고 파라미터의 값을 모두 바꿔치기함
    - merge()
    - 파라미터로 넘어온 준영속 엔티티의 식별자의 값으로 1차 캐시에 엔티티 조회
    - 없을 때 디비에서 조회 (mergeMember)
    - memrgeMember에 member엔테티 값을 모두 채워 넣는다
    - mergeMember를 반환한다.
- 변경 감지는 원하는 속성만 선택할 수 있다.
- merge는 변경하는 값을 모두 업데이트 친다. -> null값도 변경된다. -> 데이터베이스에 null값이 박힌다.
- 컨트롤러에서 엔티티를 만들지 말자
- 컨트롤러에서 서비스로 파라미터 or dto를 통해 정보를 날리고 서비스에서 엔티티를 검색 한 뒤 변경 감지를 통해 수정하자.
- 실무에서 왠만하면 세터쓰지말자^^





# 2. Jpa  +  API
- 쿼리방식 선택 권장 순서
    1. 엔티티를 DTO로 변환하는 방법 선택
    2. 필요하면 페치조인선택
    3. DTO로 직접 조회하는 방법을 사용한다.
    4. jpa 네이티브 sql이나 스프링 jdbc template을 사용한다.
